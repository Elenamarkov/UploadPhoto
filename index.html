<!DOCTYPE html>
<html lang="mk">
<head>
  <meta charset="UTF-8">
  <title>Upload Sliki</title>
  <script type="module">
    // Firebase core + Analytics
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-analytics.js";

    // Firebase Storage
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-storage.js";

    // Firebase Firestore
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

    const firebaseConfig = {
  apiKey: "AIzaSyA4r8eifiRWU7W2CUWCymwBtL-HtRp0Nng",
  authDomain: "uploadphoto-d6606.firebaseapp.com",
  projectId: "uploadphoto-d6606",
  storageBucket: "uploadphoto-d6606.firebasestorage.app",
  messagingSenderId: "495665845197",
  appId: "1:495665845197:web:9d96d8004e0612ccddaa84",
  measurementId: "G-MJRZYYMEXB"
};
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const storage = getStorage(app);
    const db = getFirestore(app);

    // Upload function
    window.uploadFiles = async () => {
      const input = document.getElementById('files');
      if (input.files.length === 0) {
        alert("Мора да избереш барем една слика!");
        return;
      }

      try {
        for (let file of input.files) {
          const storageRef = ref(storage, `uploads/${Date.now()}_${file.name}`);
          await uploadBytes(storageRef, file);
          const url = await getDownloadURL(storageRef);

          await addDoc(collection(db, "uploadedImages"), {
            name: file.name,
            url: url,
            timestamp: serverTimestamp()
          });
        }

        alert("Сликите се пратени успешно!");
        input.value = "";
      } catch (error) {
        console.error("Грешка при пратување на слики:", error);
        alert("Настана грешка, проверете конзолата.");
      }
    };
  </script>
</head>
<body>
  <h1>Избери слики од твојата галерија</h1>
  <input type="file" id="files" multiple accept="image/*">
  <button onclick="uploadFiles()">Прати</button>
</body>
</html>
